# Reservation Project

## This Project Topic 

### Project to Understand and Analyze Redis Distributed Locks

## 애플리케이션 요구사항

- 여러명이 예약을 시도하여도 문제 없이 예약 절차가 수행되어져야한다.  
- 만약 예약이 가득찼으면 예약을 할 수 없도록 해야한다.

## 요구사항 수행하기 위해 해결할 문제

- 동시성 문제  

## Redis를 통한 동시성 제어 

### Redis 분산락 

1. Redis 스핀락

- 스핀락이란?  
스핀락이란 임계영역에 접근이 가능할 때까지 계속 루프를 돌면서 재시도하는 방식으로 구현된 락을 가리킨다.  
스핀락이라는 이름은 락을 획득할 때 까지 해당 스레드가 빙빙 돌고 있다(spinning)는 것을 의미한다.  

2. Redis Pub/Sub 기능을 활용한 락

스핀락 단점
- Redis의 스핀락을 사용할 경우 Lock이 걸려있는지 확인하기 위해 Redis에 계속적으로 요청을 보낸다.  
때문에 Redis에 부하가 많이 발생할 수 있다. Lock을 잡아둔 상태에서도 spinLock은 Lock를 해제 시키지 못하는 예외
사항이 발생하였을 경우 Lock이 무한으로 잡혀있어 다른 요청이 자원을 획득할 수 없는 상태가 된다.

스핀락 단점을 극복한 Pub/Sub 

- Redisson에 구현된 tryLock 같은 경우 이러한 Pub/Sub 구조를 통해 분산락을 구현해낸 기능이다.
때문에 락이 풀렸는지를 계속 체크할 필요없이 Lock이 풀리게되면 subscribe를 통해 알려주게 된다.  
이를 통해 spinLock에서 문제가 된 Lock이 풀렸는지 확인하는 요청을 계속하지 않아도 되게 된다.  
Redisson은 또한, Lock를 얼마동안 기달려주는지도 별도의 waitTime를 주기 때문에 계속 자원을 얻기위해 
기다리지 않아도 된다.  
하지만 Redisson이라는 라이브러리를 사용하지 않고 Lettuce를 사용하거나 직접 구현을 할 경우는 복잡도가 
스핀락보다 어렵지 때문에 구현시간이 조금 더 사용이 된다.  

이 프로젝트에는 스핀락, tryLock 그리고 동시성 제어를 하지 않았을 때 어떤 현상이 발생하는지를 테스트하는
테스트코드를 만들어두었다. 

해당 테스트는 `RedisLockFacadeTest` 파일을 보면 되며, 주요 내용은 예약시스템이다. 25개의 예약 자리가 있는데 
10개의 스레드가 동시에 요청을 했을 때 어떻게 되는지를 보여주는 통합테스트이다.
